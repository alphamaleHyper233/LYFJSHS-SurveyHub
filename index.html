<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SurveyHub ‚Äì Survey Sharing Platform</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg); color: var(--text); transition: background 0.3s ease, color 0.3s ease; }
    :root { --bg: #121212; --text: #f4f4f4; --card-bg: #1e1e1e; --card-text: #e0e0e0; --btn-bg: #007bff; --btn-hover: #0056b3; }
    body.light { --bg: #f4f6f9; --text: #222; --card-bg: #fff; --card-text: #333; --btn-bg: #007bff; --btn-hover: #0056b3; }
    .navbar { padding: 0.5rem 1rem !important; }
    .main-content { padding: 20px; }
    .survey-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
    .survey-card { display: flex; flex-direction: column; border: none; border-radius: 10px; padding: 20px; background: var(--card-bg); color: var(--card-text); box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.2s ease, box-shadow 0.2s ease; }
    .survey-card:hover { transform: translateY(-4px); box-shadow: 0 6px 10px rgba(0,0,0,0.15); }
    .survey-actions { display: flex; gap: 10px; margin-top: 10px; }
    .survey-card button { align-self: flex-start; padding: 8px 14px; background: var(--btn-bg); color: white; font-size: 14px; font-weight: 500; text-decoration: none; border-radius: 6px; border: none; cursor: pointer; transition: background 0.2s ease; }
    .survey-card button:hover { background: var(--btn-hover); }
    .submit-button a button { padding: 12px 22px; background: linear-gradient(90deg, #28a745, #218838); color: white; border: none; border-radius: 8px; font-weight: 600; box-shadow: 0 4px 8px rgba(0,0,0,0.3); transition: transform 0.2s ease, background 0.2s ease; }
    .submit-button a button:hover { transform: scale(1.03); background: linear-gradient(90deg, #218838, #1e7e34); }
    .verified { color: #1da1f2; margin-left: 6px; }
    .featured-badge { background-color: #ffc107 !important; color: #212529 !important; margin-left: 6px; }
    .expired { opacity: 0.5; pointer-events: none; }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm sticky-top">
    <div class="container-fluid d-flex justify-content-between align-items-center">
      <a class="navbar-brand fw-bold text-white" href="index.html">
        <i class="fa-solid fa-chart-pie me-2"></i>SurveyHub
      </a>
      <div class="d-flex align-items-center">
        <div class="nav-item dropdown me-3">
          <a class="nav-link text-white position-relative" href="#" role="button" data-bs-toggle="dropdown">
            <i class="fa-regular fa-bell fa-lg"></i>
            <span class="position-absolute top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-circle"></span>
          </a>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><h6 class="dropdown-header">Notifications</h6></li>
            <li><a class="dropdown-item" href="#">No new notifications</a></li>
          </ul>
        </div>
        <div class="nav-item">
          <a class="nav-link text-white d-flex align-items-center" href="settings.html">
            ‚öô Settings
          </a>
        </div>
      </div>
    </div>
  </nav>

  <div class="container mt-4 main-content">
    <h1 class="mb-4">Survey Sharing Platform</h1>
    <div class="controls mb-3 d-flex flex-wrap gap-2">
      <input id="search" type="text" class="form-control w-auto" placeholder="Search surveys...">
      <select id="strandFilter" class="form-select w-auto">
        <option value="All">All Strands</option>
        <option value="STEM">STEM</option>
        <option value="ABM">ABM</option>
        <option value="HUMSS">HUMSS</option>
        <option value="TVL">TVL</option>
      </select>
    </div>
    <div class="submit-button mb-4">
      <a href="https://forms.gle/xzs8WihbMvFkgmXg7" target="_blank">
        <button>üì© Submit Your Survey</button>
      </a>
    </div>

   <div id="featured-section">
  <h4 id="featured-title" class="mb-3">Featured Surveys</h4>
  <div class="d-flex flex-wrap mb-4" style="gap: 20px;">
    <div id="featured-surveys" class="survey-container" style="flex: 1 1 50%; min-width: 280px;"></div>

    <div class="important-message p-3 border rounded" style="flex: 1 1 50%; min-width: 250px;">
      <h5>Important Message</h5>
      <p>The other Functions like Logout, Register, Login, Notif and Profile Buttons cannot be used full PHP functionality cannot be published on free hosting platforms but you could Customize the settings.
        ‚ö†Ô∏èDont Submit any Link with Absurd content. We could record Malicious activity
      </p>
    </div>
  </div>
</div>

    <h4 class="mb-3">All Surveys</h4>
    <div id="survey-container" class="survey-container"></div>
  </div>

  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1080">
    <div id="phpToast" class="toast align-items-center text-bg-warning border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body">
          ‚ö†Ô∏è Buttons cannot be used ‚Äî full PHP functionality cannot be published on free hosting platforms but you could Customize the settings.
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  </div>

  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1080">
  <div id="linkToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">
       Link copied to clipboard!
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const toastEl = document.getElementById('phpToast');
  const toast = new bootstrap.Toast(toastEl, { delay: 4000 });

  const phpLinks = [
    '.nav-item.dropdown a.dropdown-item[href="#"]', 
    '.nav-item.dropdown.me-3 a.nav-link'           
  ];

  phpLinks.forEach(selector => {
    document.querySelectorAll(selector).forEach(el => {
      el.addEventListener("click", (e) => {
        e.preventDefault(); 
        toast.show();
      });
    });
  });
});

document.addEventListener("DOMContentLoaded", () => {
  const theme = localStorage.getItem("theme");
  const textSize = localStorage.getItem("textSize") || "medium";
  if (theme === "light") document.body.classList.add("light");
  document.body.style.fontSize = textSize === "small" ? "14px" : textSize === "large" ? "20px" : "16px";
});

const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT-YWTeGWQSC8TH-UlRIRb7RPaJtX-Qum-RdPJBlc1n_d49XKHFDreC9XNPmww5zkAmGBB8NNrsYILE/pub?gid=2015938335&single=true&output=csv";
let surveys = [];

function parseCSV(text) {
  const rows = [];
  let current = [], inQuotes = false, value = "";
  for (let i=0;i<text.length;i++){
    const char=text[i];
    if(char=='"' && text[i+1]=='"'){ value+='"'; i++; }
    else if(char=='"'){ inQuotes=!inQuotes; }
    else if(char==',' && !inQuotes){ current.push(value.trim()); value=""; }
    else if((char=='\n'||char=='\r') && !inQuotes){
      if(char=='\r'&&text[i+1]=='\n'){i++;}
      current.push(value.trim());
      if(current.length>1) rows.push(current);
      current=[]; value="";
    } else { value+=char; }
  }
  if(value || current.length) current.push(value.trim());
  if(current.length) rows.push(current);
  return rows;
}

fetch(sheetURL)
  .then(res => res.text())
  .then(csv => {
    const rows = parseCSV(csv);
    rows.shift(); 
    surveys = rows.map((r,i)=>({
      id: i+1,
      title: r[0],
      description: r[1],
      strand: r[2],
      link: r[3],
      featured: r[4]?.trim().toLowerCase() === "yes" ? "yes" : "no",
      verified: r[5]?.trim().toLowerCase() === "yes" ? "yes" : "no",
      expired: r[6]?.trim().toLowerCase() === "yes" ? "yes" : "no"
    })).filter(s=>s.title && s.link);

    renderFeaturedSurveys();
    renderSurveys(surveys);
  });

function renderFeaturedSurveys(){
  const container = document.getElementById("featured-surveys");
  const titleElem = document.getElementById("featured-title");
  const featuredList = surveys.filter(s => s.featured==="yes");
  
  if(featuredList.length === 0){
    container.innerHTML = "";
    titleElem.style.display = "none";
    return;
  }

  container.style.display = "grid";
  titleElem.style.display = "block";
  container.innerHTML = "";

  featuredList.forEach(s=>{
    const expiredClass = s.expired==="yes" ? "expired" : "";
    const verifiedTag = s.verified==="yes" ? '<i class="fa-solid fa-check verified" title="Verified"></i>' : '';
    const featuredBadge = '<span class="badge featured-badge">Featured</span>';

    container.innerHTML+=`
      <div class="survey-card ${expiredClass}">
        <h5>${s.title} ${verifiedTag} ${featuredBadge}</h5>
        <p class="strand"><b>Strand:</b> ${s.strand || "N/A"}</p>
        <p class="description">${s.description || "No description available"}</p>
        <div class="survey-actions">
          <button class="take-btn" data-id="${s.id}" data-title="${encodeURIComponent(s.title)}"
            data-desc="${encodeURIComponent(s.description)}" data-link="${encodeURIComponent(s.link)}">
            <i class="fa-solid fa-pen"></i> Take Survey
          </button>
          <button class="share-btn" data-id="${s.id}" data-title="${encodeURIComponent(s.title)}"
            data-desc="${encodeURIComponent(s.description)}" data-link="${encodeURIComponent(s.link)}">
            <i class="fa-solid fa-share-nodes"></i> Share
          </button>
        </div>
      </div>`;
  });

  attachButtonEvents(container);
}

function renderSurveys(list){
  const container=document.getElementById("survey-container");
  container.innerHTML="";
  list.forEach(s=>{
    const expiredClass = s.expired==="yes" ? "expired" : "";
    const featuredBadge = s.featured==="yes" ? '<span class="badge featured-badge">Featured</span>' : '';
    const verifiedTag = s.verified==="yes" ? '<i class="fa-solid fa-check verified" title="Verified"></i>' : '';
    container.innerHTML+=`
      <div class="survey-card ${expiredClass}">
        <h5>${s.title} ${verifiedTag}</h5>
        <p class="strand"><b>Strand:</b> ${s.strand || "N/A"} ${featuredBadge}</p>
        <p class="description">${s.description || "No description available"}</p>
        <div class="survey-actions">
          <button class="take-btn" data-id="${s.id}" data-title="${encodeURIComponent(s.title)}"
            data-desc="${encodeURIComponent(s.description)}" data-link="${encodeURIComponent(s.link)}">
            <i class="fa-solid fa-pen"></i> Take Survey
          </button>
          <button class="share-btn" data-id="${s.id}" data-title="${encodeURIComponent(s.title)}"
            data-desc="${encodeURIComponent(s.description)}" data-link="${encodeURIComponent(s.link)}">
            <i class="fa-solid fa-share-nodes"></i> Share
          </button>
        </div>
      </div>`;
  });
  attachButtonEvents(container);
}

function attachButtonEvents(container){
  container.querySelectorAll(".take-btn").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const title = btn.dataset.title;
      const desc = btn.dataset.desc;
      const link = btn.dataset.link;
      window.location.href = `${window.location.origin}/LYFJSHS-SurveyHub/view-survey.html?title=${title}&desc=${desc}&link=${link}`;
    });
  });

 container.querySelectorAll(".share-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    const title1 = decodeURIComponent(btn.dataset.title);
    const desc1 = decodeURIComponent(btn.dataset.desc);
    const title = btn.dataset.title;
    const desc = btn.dataset.desc;
    const link = btn.dataset.link;

    const shareURL = `https://alphamalehyper233.github.io/LYFJSHS-SurveyHub/view-survey.html?title=${title}&desc=${desc}&link=${link}`;
    const message = `${shareURL} \n \n Check out this research survey: "${title1}" \n \n ${desc1} `;

    navigator.clipboard.writeText(message)
      .then(() => {
        const toastEl = document.getElementById("linkToast");
        const toast = new bootstrap.Toast(toastEl);
        toast.show();
        console.log(" Copied:", shareURL);
      })
      .catch(err => console.error(" Failed to copy:", err));
  });
});
}

document.getElementById("search").addEventListener("input", applyFilters);
document.getElementById("strandFilter").addEventListener("change", applyFilters);

function applyFilters() {
  const query = document.getElementById("search").value.toLowerCase();
  const strand = document.getElementById("strandFilter").value;
  const featuredSection = document.getElementById("featured-section");

  console.log("Search query:", query);
  console.log("Selected strand:", strand);
  console.log("All surveys:", surveys);

  let filtered = surveys.filter(s => {
    if (!s.title) return false;
    const title = s.title.toLowerCase().trim();
    const search = query.toLowerCase().trim();
    return !search || title.includes(search);
  });

  console.log("After search filter:", filtered);

  if (strand !== "All") {
    filtered = filtered.filter(s =>
      (s.strand || "").toLowerCase() === strand.toLowerCase()
    );
    featuredSection.style.display = "none";
  }

  console.log("After strand filter:", filtered);

  if (query.trim().length > 0 || strand !== "All") {
    featuredSection.style.display = "none";
  } else {
    featuredSection.style.display = "block";
  }


  renderSurveys(filtered);

  console.log("Final rendered surveys:", filtered.length);
}
</script>
</body>
</html>





